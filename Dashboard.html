<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinAi - Dashboard</title>
    <link rel="stylesheet" href="/css/Dashboard.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
    </head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-logo">
                <img src="https://finai.es/images/Logo_FinAI_Oficial.png" alt="FinAi Logo Small">
                </div>
        
            <nav class="sidebar-nav">
                <button class="nav-button" id="navDashboard" data-page="/Dashboard.html" title="Dashboard">
                    <i class="fas fa-home"></i> <span>Dashboard</span>
                </button>
                <button class="nav-button" id="navAccounts" data-page="/Accounts.html" title="Cuentas">
                    <i class="fas fa-wallet"></i> <span>Cuentas</span>
                </button>
                <button class="nav-button" id="navBudgets" data-page="/Budgets.html" title="Presupuestos">
                    <i class="fas fa-chart-pie"></i> <span>Presupuestos</span>
                </button>
                <button class="nav-button" id="navCategories" data-page="/Categories.html" title="Categorías">
                    <i class="fas fa-tags"></i> <span>Categorías</span>
                </button>
                <button class="nav-button" id="navTransactions" data-page="/Transactions.html" title="Transacciones">
                    <i class="fas fa-exchange-alt"></i> <span>Transacciones</span>
                </button>
                <button class="nav-button" id="navTrips" data-page="/Trips.html" title="Viajes">
                    <i class="fas fa-suitcase-rolling"></i> <span>Viajes</span>
                </button>
                <button class="nav-button" id="navEvaluations" data-page="/EvaluaCIONES.html" title="Evaluación">
                    <i class="fas fa-balance-scale"></i> <span>Evaluación</span>
                </button>
                <button class="nav-button" id="navReports" data-page="/Reports.html" title="Informes">
                    <i class="fas fa-chart-bar"></i> <span>Informes</span>
                </button>
                <button class="nav-button" id="navProfile" data-page="/Profile.html" title="Perfil">
                     <i class="fas fa-user-circle"></i> <span>Perfil</span>
                 </button>
                <button class="nav-button" id="navSettings" data-page="/Settings.html" title="Configuración">
                    <i class="fas fa-cog"></i> <span>Configuración</span>
                </button>
            </nav>
        
            <button class="nav-button logout-button" id="btnLogoutSidebar" title="Cerrar Sesión">
                <i class="fas fa-sign-out-alt"></i> <span>Salir</span>
            </button>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="header-left">
                    <button class="btn-icon hamburger-btn" id="hamburgerBtn" aria-label="Abrir menú"><i class="fas fa-bars"></i></button>
                    <div class="header-title">
                        <span id="pageTitle">Dashboard</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="btn-icon notification-btn" id="notificationBell" aria-label="Notificaciones">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge" style="display: none;"></span>
                    </button>
                    <button class="btn-icon profile-btn" id="profileBtnHeader" aria-label="Mi Perfil">
                        <img id="userAvatarHeader" src="https://finai.es/images/avatar_predeterminado.png" alt="Avatar" class="header-avatar-small">
                    </button>
                    </div>
            </header>
            <div id="notificationPanel" class="notification-panel">
                <div class="notification-panel-header">
                    <h4>Notificaciones</h4>
                    <button id="markAllReadBtn" class="btn-link-small" title="Marcar todas como leídas">Marcar todas leídas</button>
                </div>
                <div id="notificationList" class="notification-list">
                    <p class="panel-loading">Cargando...</p>
                    </div>
            </div>

            <section id="dashboardGrid" class="dashboard-grid">

                <div class="panel summary-panel">
                    <h3 id="greeting">¡Hola!</h3>
                    <p class="summary-amount" id="totalBalance">Calculando...</p>
                    <div id="variableSpendingProgress" class="progress-bar-container" style="margin-top: 5px; margin-bottom: 15px;">
                        <div class="progress-bar-placeholder" style="height: 10px; background-color: var(--border-color); border-radius: 5px;"></div> 
                    </div>
                    <div class="panel quick-actions-panel">
                        <h3>Acciones Rápidas</h3>
                        <div class="quick-actions-buttons">
                            <button id="quickAddExpenseBtn" class="btn btn-action red-btn"><i class="fas fa-minus"></i> Gasto</button>
                            <button id="quickAddIncomeBtn" class="btn btn-action green-btn"><i class="fas fa-plus"></i> Ingreso</button>
                       </div>
                    </div>
                    
                </div>

                 <div class="panel budget-summary-panel">
                    <h3>Presupuestos Este Mes <a href="/Budgets.html" class="panel-link"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="budgetSummaryList">
                        <p class="panel-loading">Cargando presupuestos...</p>
                        </div>
                 </div>

                 <div class="panel upcoming-payments-panel">
                      <h3>Próximos Pagos <a href="/Fixed_expenses.html" class="panel-link"><i class="fas fa-arrow-right"></i></a></h3>
                      <div id="upcomingPaymentsList">
                          <p class="panel-loading">Cargando pagos...</p>
                          </div>
                 </div>

                 <div class="panel goals-progress-panel">
                     <h3>Progreso de Metas <a href="/Goals.html" class="panel-link"><i class="fas fa-arrow-right"></i></a></h3>
                     <div id="goalsProgressList">
                         <p class="panel-loading">Cargando metas...</p>
                         </div>
                 </div>

                 <div class="panel recent-activity-panel">
                      <h3>Actividad Reciente <a href="/Transactions.html" class="panel-link"><i class="fas fa-arrow-right"></i></a></h3>
                       <div id="recentActivityList">
                           <p class="panel-loading">Cargando actividad...</p>
                           </div>
                 </div>
                 <div class="panel debts-summary-panel"> 
                    <h3>Deudas <a href="/Debts.html" class="panel-link" aria-label="Ver Deudas"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="debtsSummaryContent"> 
                        <p class="panel-loading">Cargando resumen...</p>
                    </div>
                </div>
                <div class="panel loans-summary-panel"> 
                    <h3>Préstamos <a href="/Loans.html" class="panel-link" aria-label="Ver Préstamos"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="loansSummaryContent"> <p class="panel-loading">Cargando resumen...</p>
                    </div>
                </div>
                <div class="panel trips-summary-panel"> <h3>Próximo Viaje <a href="/Trips.html" class="panel-link" aria-label="Ver Viajes"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="nextTripSummaryContent">
                        <p class="panel-loading">Buscando próximo viaje...</p>
                    </div>
                </div>
                <div class="panel evaluation-summary-panel" class="panel-link"> <h3>Planificación Mensual <a href="/Evaluaciones.html" aria-label="Ver Planificación"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="evaluationSummaryContent">
                        <p class="panel-loading">Cargando planificación...</p>
                    </div>
                </div>
                <div class="panel accounts-summary-panel"> <h3>Resumen Cuentas <a href="/Accounts.html" class="panel-link" aria-label="Ver Cuentas"><i class="fas fa-arrow-right"></i></a></h3>
                    <div id="accountsSummaryContent">
                        <p class="panel-loading">Cargando cuentas...</p>
                    </div>
                </div>

                 <div class="panel quick-actions-panel">
                     <h3>Acciones Rápidas</h3>
                     <div class="quick-actions-buttons">
                         <button id="quickAddExpenseBtn" class="btn btn-action red-btn"><i class="fas fa-minus"></i> Gasto</button>
                         <button id="quickAddIncomeBtn" class="btn btn-action green-btn"><i class="fas fa-plus"></i> Ingreso</button>
                         <button id="quickAddTripExpenseBtn" class="btn btn-action orange-btn">
                            <i class="fas fa-route"></i> Gasto Viaje
                        </button>
                    </div>
                 </div>

            </section>
        </main>
    </div>
    <div id="tripExpenseModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="modalTitleTripExpense">Añadir Gasto del Viaje</h2>
            <form id="tripExpenseForm">
                <input type="hidden" id="tripExpenseId" name="tripExpenseId">
                <input type="hidden" id="expenseTripId" name="expenseTripId"> 
                <div class="input-group" id="tripSelectorGroup"> <label for="quickExpenseTripSelect">¿Para qué Viaje es este Gasto?</label>
                    <select id="quickExpenseTripSelect" name="quickExpenseTripSelect" required>
                        <option value="" disabled selected>Selecciona un viaje...</option>
                        </select>
                </div>
                <input type="hidden" id="tripExpenseId" name="tripExpenseId">
                <input type="hidden" id="expenseTripId" name="expenseTripId"> 
                <div class="input-group"> <label for="tripExpenseDescription">Descripción del Gasto</label> <input type="text" id="tripExpenseDescription" name="tripExpenseDescription" required placeholder="Ej: Vuelo, Hotel Noche 1, Comida Museo..."> </div>
                <div class="input-group"> <label for="tripExpenseAmount">Importe (€)</label> <input type="number" id="tripExpenseAmount" name="tripExpenseAmount" required step="0.01" placeholder="0.00" min="0.01"> </div>
                <div class="input-group"> <label for="tripExpenseDate">Fecha del Gasto</label> <input type="date" id="tripExpenseDate" name="tripExpenseDate" required> </div>
                <div class="input-group"> <label for="tripExpenseCategory">Categoría (Texto)</label> <input type="text" id="tripExpenseCategory" name="tripExpenseCategory" placeholder="Ej: Transporte, Alojamiento, Comida, Ocio..."> </div>
                <div class="input-group"> <label for="tripExpenseNotes">Notas (Opcional)</label> <textarea id="tripExpenseNotes" name="tripExpenseNotes" rows="2"></textarea> </div>
                <div class="modal-actions"> 
                    <button type="button" id="cancelTripExpenseButton" class="btn btn-secondary">Cancelar</button> 
                    <button type="submit" id="saveTripExpenseButton" class="btn btn-primary">Guardar Gasto</button> 
                </div>
                <p id="modalTripExpenseError" class="error-message" style="display: none;"></p>
            </form>
        </div>
    </div>

    <div id="transactionModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2 id="modalTitleTransaction">Añadir Transacción</h2>
            <form id="transactionForm">
                <input type="hidden" id="transactionId" name="transactionId">
    
                <div class="input-group">
                    <label>Tipo de Movimiento</label>
                    <div class="radio-group type-toggle">
                        <label class="type-button expense-btn active">
                            <input type="radio" name="transactionType" value="gasto" checked> Gasto
                        </label>
                        <label class="type-button income-btn">
                            <input type="radio" name="transactionType" value="ingreso"> Ingreso
                        </label>
                        <label class="type-button transfer-btn"> <input type="radio" name="transactionType" value="transferencia"> Transferencia
                        </label>
                    </div>
                </div>
    
                <div class="input-group">
                    <label for="transactionAmount">Importe</label>
                    <input type="number" id="transactionAmount" name="transactionAmount" required step="0.01" placeholder="0.00">
                </div>
    
                <div class="input-group">
                    <label for="transactionDate">Fecha</label>
                    <input type="date" id="transactionDate" name="transactionDate" required>
                </div>
    
                <div class="input-group">
                    <label for="transactionDescription">Descripción</label>
                    <input type="text" id="transactionDescription" name="transactionDescription" required placeholder="Ej: Café, Nómina Enero, Transfer Ahorro...">
                </div>
    
                 <div class="input-group" id="accountSourceGroup">
                     <label for="transactionAccount" id="transactionAccountLabel">Cuenta</label>
                     <select id="transactionAccount" name="transactionAccount" required>
                         <option value="" disabled selected>Selecciona una cuenta...</option>
                         </select>
                 </div>
    
                 <div class="input-group" id="accountDestinationGroup" style="display: none;">
                      <label for="transactionAccountDestination">Cuenta Destino</label>
                      <select id="transactionAccountDestination" name="transactionAccountDestination"> <option value="" disabled selected>Selecciona cuenta destino...</option>
                          </select>
                 </div>
    
                 <div class="input-group" id="categoryGroup">
                       <label for="transactionCategory">Categoría</label>
                       <select id="transactionCategory" name="transactionCategory">
                           <option value="">(Sin categoría)</option>
                           </select>
                   </div>
    
                 <div class="input-group">
                     <label for="transactionNotes">Notas (Opcional)</label>
                     <textarea id="transactionNotes" name="transactionNotes" rows="2"></textarea>
                 </div>
    
                <div class="modal-actions">
                    <button type="button" id="cancelTransactionButton" class="btn btn-secondary">Cancelar</button>
                    <button type="submit" id="saveTransactionButton" class="btn btn-primary">Guardar Transacción</button>
                </div>
                <p id="modalTransactionError" class="error-message" style="display: none;"></p>
            </form>
        </div>
    </div>

    <button id="scrollTopBtn" class="scroll-top-btn" title="Volver arriba" style="display: none;">
         <i class="fas fa-arrow-up"></i>
     </button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/Js/supabase-init.js"></script>
    <script src="/Js/auth-listener.js"></script> 
    <script src="/Js/Dashboard.js"></script> 
</body>
</html>